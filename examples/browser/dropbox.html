<!DOCTYPE html>
<html>
<body>
  <h1>REM Dropbox API</h1>

  <div id="account">
    <h2>Welcome</h2>
  </div>
  <div id="songs"></div>
  </body>


<script src="../../lib/rem.js"></script>
<script src='http://code.jquery.com/jquery.js'></script>
<script>

$('#account').hide()

var manifest = {
  //"1": {
    "name": "Dropbox",
    "docs": "https://www.dropbox.com/developers",
    "control": "https://www.dropbox.com/developers/apps",

    "base": [
      ["^/(files(_put)?|thumbnails)/.*", "https://api-content.dropbox.com/1"],
      "https://api.dropbox.com/1"
    ],
    
    "jsonp": true,

    "auth": {
      "type": "oauth",
      "version": "1.0",
      "requestEndpoint": "https://api.dropbox.com/1/oauth/request_token",
      "accessEndpoint": "https://api.dropbox.com/1/oauth/access_token",
      "authorizeEndpoint": "https://www.dropbox.com/1/oauth/authorize",
      "validate": "/account/info",
      "oob": true,
      "oobVerifier": false
    }
  //}
};

// rem.loadAsync('dropbox.json', '1', function (err, dropbox) {
// dropbox.prompt(function (err, user) {
rem.create(manifest, {
  key: $('#dropbox-key').val(),
  secret: $('#dropbox-secret').val()
}).prompt(function (err, user) {
  user('account/info').get(function (err, json) {
    $('#account').show()
    $('#account h2').text('Welcome, ' + json.display_name)
  });

  user('metadata/sandbox').get(function (err, json) {
    json.contents.forEach(function (f) {
      if (f.mime_type == 'audio/mpeg') {
        user('media/sandbox', f.path).get(function (err, json) {
          $('#songs').append('<h3>' + f.path + '</h3>')
          $('#songs').append('<audio src="' + json.url + '" controls>No audio!</audio>')
        });
      }
    });
  })
});

</script>
</html>